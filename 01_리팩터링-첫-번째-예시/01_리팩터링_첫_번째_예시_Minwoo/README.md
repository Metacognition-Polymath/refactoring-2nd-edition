# Chapter 01. 리팩터링: 첫 번째 예시

## 개요

- 본격적인 리팩터링 학습에 앞서 실제 코드가 리팩터링을 통해 어떻게 개선되는지를 보여주는 챕터
- 본 예시에서 다음과 같은 리팩터링 기법이 소개됨.
  - Chapter 6
    - 6.1. 함수 추출하기
    - 6.2. 함수 인라인 하기
    - 6.4. 변수 인라인 하기
    - 6.5. 함수 선언 바꾸기
    - 6.11. 단계 쪼개기
  - Chapter 7
    - 7.4. 임시 변수를 질의 함수로 바꾸기
  - Chapter 8
    - 8.1. 함수 옮기기
    - 8.6. 문장 슬라이드하기
    - 8.7. 반복문 쪼개기
    - 8.8. 반복문을 파이프라인으로 바꾸기
  - Chapter 10
    - 10.4. 조건부 로직을 다형성으로 바꾸기
  - Chapter 11
    - 11.8. 생성자를 팩터리 함수로 바꾸기
  - Chapter 12
    - 12.6. 타입 코드를 서브클래스로 바꾸기

## 실습

- 아무 생각 없이 코드를 따라 치는 것을 방지하기 위해 다른 언어로 예시 코드 작성
- 중첩 함수를 자유룝게 허용하지 못하는 것 외에는 JS와 유사
- [mwjjeong/refactoring-python/Chapter01](https://github.com/mwjjeong/refactoring-python/tree/main/Chapter01)

## 실습 분석

- 첫 번째로 리팩터링을 진행하기 전에 무조건 올바른 동작 검증을 위한 **테스트 코드를 필수적으로 준비**해야 한다.
- 각 리팩터링 단계 이후에는 무조건 **컴파일-테스트-커밋**
- 전체 동작을 살펴보고 의미 있는 단계로 따로 분리할 수 있는 지점을 찾는다.
- 분리할 수 있는 지점에 대해 _함수 추출하기_ 사용

  - 추출 작업을 쉽게 하기 위해 최대한 임시 변수를 줄이는 방향으로 코드를 수정한다.
  - _임시 변수를 질의 함수로 바꾸기_, _변수 인라인 하기_ 를 사용한다.
  - _변수 인라인 하기_ 후 _함수 선언 바꾸기_ 를 통해 매개 변수 제거한다.
  - 추출 후 의미를 명료하게 하기 위해 함수, 변수명 등을 변경한다.

- 반복문이 많은 기능을 수행하는 경우

  - _반복문 쪼개기_ 를 활용한다.
  - 추출 작업을 쉽게 하기 위해 _문장 슬라이드_ 하기 사용
  - 쪼갠 반복문으로부터 _함수 추출하기_ 사용
  - _변수 인라인 하기_ 로 임시 변수 제거

- 기능 추가를 용이하게 하기 위해 _단계 쪼개기_ 진행

  - 단계 간 데이터 전달을 하기 위해 중간 데이터 구조 활용
  - 본 예시에서는 데이터 계산 단계와 출력 (렌더링) 단계를 구분
  - 단계 분리 과정에서 _함수 옮기기_ 사용
  - 각 단계를 별도의 파일로 정리하여 저장

- 반복문을 명료하게 하기 위해 _반복문을 파이프라인으로 바꾸기_ 를 사용

  - `for` loop 대신 `reduce`

- 코드의 확장성을 위해 _조건부 로직을 다형성 로직으로 대체_
  - 기능 추가 과정에서 일일이 조건문을 수정하도록 코드를 작성하는 것보다는 서브 클래스를 추가하는 것이 확장성, 가독성 면에서 좋다.
  - 상속 계층을 정의하고 조건부 로직을 포함하는 함수를 전용 클래스로 옮김.
  - 이 과정에서 _함수 옮기기_, _함수 선언 바꾸기_ 등 사용
  - 해당 함수들을 클래스의 메소드로 옮긴 후 _함수 인라인 하기_ 사용
  - _타입 코드를 서브클래스로 바꾸기_ 하여 각 조건문의 타입에 해당하는 서브클래스로 정의함
  - _생성자를 팩터리 함수로 바꾸기_ 로 **조건문은 오직 팩터리 함수에서만** 사용하도록 일원화

## 조언

- 리팩터링을 하는 것은 코드 수정을 용이하게 하기 위함이다.
- 프로그램이 새로운 기능을 추가하기 편한 구조가 아니면 기능을 추가하기 쉬운 형태로 리팩터링 한 후 기능 추가를 진행해야 한다.
- **리팩터링 전에는 무조건 리팩터링할 코드를 꼼꼼하게 검사할 수 있는 테스트 코드부터 작성**해야 한다.
- 리팩터링 후에는 작은 단계여도 무조건 **테스트**를 한다. 테스트 후 **문제 없을 때만 커밋**한다.
- 복잡한 조건문을 쉽게 수정할 수 있도록 리팩토링 하기 위해 **다형성과 팩터리 함수**를 사용한다.
