# 02. 리팩터링 원칙

## 2.1 리팩터링 정의

 - 명사적 의미: 소프트웨어의 겉보기 동작은 유지한채, 코드 이해 수정하기 쉽도록 내부 구조 변경하는 기법(함수 추출, 조건부 로직 다형성 바꾸기)
 - 동사적 의미: 소프트웨어의 겉보기 동작은 그대로 유지한채, 여러 가지 리팩터링 기법을 적용해서 소프트웨어를 재구성하다.
 - 작은 단계 코드 수정, 모여서 코드 수정 => 항상 언제든지 작동할수있는 단계로 만들어야함(작동을 안하면 리팩토링이 아님)
 - 자잘하게 하는걸 비효율적으로 생각함 => 체계적 구성으로 디버깅하는데 시간을뺏기지 않음 
 - 겉보기동작: 리팩터링 하기 전후의 코드가 똑같이 작동해야함(콜스택이 달라짐, 인터페이스가 바뀔수 있음, but 버그는 남겨두자)

## 2.2 두개의 모자

 - 기능 추가, 리팩터링 동시에 하지 말자
 - 집중해서 한가지씩 작업을 하고 섞어서 하지말자

## 2.3 리팩터링하는 이유

 1) 소프트웨어 설계가 좋아진다
    - 내부 설계가 썩시 쉽다.
    - 단기적인 목표 코드 수정을 하면 기반구조가 무너짐(중복 코드 제거) 
    - 경험상 a,b,c 복붙하는 코드가 실제로 존재 제각기 작동하는 코드가 존재했음
 2) 소프트웨어를 이해하기 쉬어진다
    - 프로그래밍: 내가 원하는 바를 정확히 표현하는 일
    - 내 소스는 컴퓨마나 보는게 아님(몇개월 뒤 나, 다른 사람): 유지보수에 좋은 코드
    - 잘 작동하지만 이상적인 구조 아닐때, 리팩토링 하자(코드 목적을 잘 드러나게하자)
    - 배려의 대상은 내가 될 확률이 높다(기억적으로 코드 작동방식을 머리속에 넣지 말자)
 3) 버그 쉽게 찾을 수 있음
    - 2번과 유사함, 가정적으로 했던 코드를 좀 더 명확하게 발견함
    - me: 코드 길어서 추축만 하지, 정확히 재현하기가 어려웠다.
 4) 프로그래밍 속도 높일 수 있다
    - 리팩토링 없는 코드는 초기에는 빠르지만 기능 추가시 훨씬 오래 걸림
    - 패치에 패치일경우 동작하는 기능을 추적하기 어려워짐(me:if문에 해당되는 아이디가 중복 혹은 다수로 걸려있는 케이스를 봄)
    - 20년전 설계의 중요성, 현재는 x, 완벽히 추측 불가, 사용할때마다 코드는 부패해짐

## 2.4 언제 리팩터링해야 할까?
  - 글쓴이: 한 시간 간격 리팩토링 진행한다
  ~~~
     3의 법칙
      1. 처음에 그냥한다
      2. 비슷한 일을 두 번째로 하게 되면(중복이 생기고 있음), 일단 계속 진행함
      3. 비슷한 일을 세번째 만날 경우 리펙터링한다
  ~~~
   1) 준비를 위한 리팩터링: 기능을 쉽게 추가하게 만들기
      - 기능을 새로 추가 직전, 현재 코드를 변경하면 쉬울꺼같다.
      - 함수를 매개변수화하기, 함수에 필요한 매개변수 지정 호출
   2) 이해를 위한 리팩터링: 코드를 이해가 쉽게 만들기
      - 코드를 수정하려면 먼저 그 코드 하는 일 파악
      - 의도 명확할수있는 유무를 찾아보고, 조건부 로직이 이상하지 않는 지 살펴보고, 함수 이름 확인, 변수명 변경
      - 긴 함수 나누기
   3) 쓰레기 줍기 리펙터링
      - 비효율적인 처리, 쓸데없이 복잡함, 불필요한 매개변수화한 함수가 존재 할 경우
      - 절출 해서 해결: 간단한 수정은 즉시 고치고, 시간이 좀 걸리는 일은 짧은 메모만 남기고, 나중에 처리
      - 조금이나 개선하자, 조금씩하다보면 개선이 될 것이다.
   4) 계획된 리팩터링과 수시로 하는 리팩터링
      - 수시로 리팩터링 한다.
      - 잘 되어있는것도 리팩터링한다.
      - 수정하기전에 정돈 하고, 다음 쉽게 수정하자
   5) 오래 걸리는 리팩터링
      - 대부분 몇 분안 끝난다. 팀 전체가 하는 리팩터링도 있다.
      - ex)라이브러리를 새 것으로 교체하는 작업
      - 라이브러리르 교체시 추상인터페이스를 호출 하고 변경시 같은 기능을 할 수 있게 한다.
   6) 코드 리뷰 리팩터링 화룡
      - 정기적으로 수행 조직
      - 다른 사람에게 피드백을 받고 아이디어를 얻을수있다.
      - 리팩터링을 습관하 하면 다른 사람에게 리뷰를 쉽게 할 수 있따
      - 풀 리퀘스트보다, 참적자를 동반해 리뷰를 하거나, 짝프로그래밍을 하자
   7) 관리자에게 뭐라고 말해야할까?
      - 관리자가 리팩터링을 충분히 ... 이해를 하고 있는가ㅓ
      - 개발자는 프로다., 구체적인 판단은 개발자가 하기에 일정을 여유있게하고 리팩터링을 한다.
      - 먼...? 이해를 할 수 없는 말들뿐
   8) 리팩터링을 하지 말아야 할 때
      - 외부 API 다루듯 호출해서 쓴느 코드면 그냥 둔다.(내부 동작을 잘 알아야 한다)
      - 처음 부터 만들어야할때(경험이 필요함)

## 2.5 리팩터링 시 고려할 문제들
   1) 새 기능 개발 속도 저하
   - 리펙터링이야말로 속도 증가다. 설계를 잟 하니, 더 더욱 좋을꺼다
   - 작은 기능 추가는 적당히 조율해서 하자.
   - 리펙토링을 할 수 있는 개발 문화를 만들자.
   - 예쁘자고 하는게 아니고 경제적이라고 설득을 해야된다

   2) 코드 소유권
      - 코드 소유권이 나에게 없을 경우 힘드니, 코드 소유권을 느슨하게 만드는 문화를 만들자
      
   3) 브랜치
      - 기능을 특정 브랜치에 구현하고, 프로덕션 버전 릴리스할때 마스터 통합하는 경우 많다.
      - 기능을 며오학히 나누고, 롤백하기 쉽다.
      - 독립 브랜치로 작업 할수록 통합하기 어려워진다.
      - 짧은 기간안에 통합 해야한다고 주장함(지속적 통합)
      - 트렁크 기반 개발. 브랜치들을 차이를 맞추자
      - 거대한 기능을 잘게 쪼개고, 기능 플래그 적용 완료에따라, 마스터를 관리해야된다.
      
   4) 테스팅
      - 리펙토링 결과를 오류르 빨리 잡으려면 테스트 트위트가 필요하다
      - 자가 테스트 코드를 마련해야한다.
      - 버그 제거가 쉽다.
      
   5) 레거시 코드
     - 레거시는 싫다
     - 리팩터링이 최적합하지만, 테스트 코드가 없을것이다.
     - 결론은 테스트 코드를 작성해라
   6) 데이터 베이스
     - 어렵다
     - 필드 이름 정도는 개선 할 수 있는거 같다. 자세한 건 관련된 책을 한 번 봐보자

## 2.6 리팩터링, 아키텍처, 애그니(YAGNI)
   - 처음 글쓴이는, 설계 및 아키텍처를 완료해야한다고 배움
   - 아키텍처 및 코드는 부패해 져있다고 생각한다.
   - 리팩터링은 관점을 바꿧다 관점을, 테스크 코드가 없으면 어렵다..
   - 아키텍처를 코디전에 할려면 요구사항을 먼저 파악해야한다는것. 실현 할 수 없다.
   - 유연성 메커니즘을 심자.(다양한 매개변수를 받을 수 있게 처리해야한다. 함수 복잡 해진다. 어려워진다) - 단점이 많다
   - 리펙터링을 미루면 훨씬 힘들어진다는 확인이 들떄 유연성 메커니즘을 미리 추가한다(무슨 소리인고?)
   - 간결한 설계, 점찐적 설계, YAGNI(필요 없을 거다)
   - 아키텍처를 무시하라는 말이 아니다. 간단히 하고 우선 점진적으로 아키텍처를 발전시키자

## 2.7 리팩터링과 소프트웨어 개발 프로세스
   - 자가 테스트코드 + 리펙터링 = TDD
   - 애자일을 할려면 팀의 역량, 열정 뒷 받침
   - 자가 테스트 코드 짜라~
   - 다른 사람 방해가 않게 하기위해 리팩터링을 할 수 있어야 한다(수시통합)
   - YAGNI 적용 할 수 있따. 실무에 적용하기 어렵다.
   - 실력과 연습 뒷받침돼어야한다
       
## 2.8 리팩터링과 성능
  - 직관적인 설계 vs 성능
  - 글쓴이: 설계의 순수성 우선시, 하드웨어의 발전
  - me: 종교적인 영역인 부분..
  - 먼저 설계(튜닝 쉽게) 하고 원하는 속도가 나오게 튜닝하자
  - 
    빠른 소프트웨어 작성 방법
    1) 예산 분배 방식
      가장 엄격 방법: 
      - 하드 리얼타임시스템?에서 사용,
      - 설계를 여러 컴포넌트 나눠 시간과 공간 예산 할당
    2) 끈임없이 관심 기울이는 방법
      - 성능 유지하기위 무슨일 하는 방법? 정확히 어떤방법을 기울이라는거니 ㅈ설명 부족
      - 성능 최적화 해봤자제대로 충분히 얻는 사례는 극히 드믈다(실제 성능 최적화 방식을 택했지만, 추측x, 직접 측정하면서 해보자)
      - 실제로 극히 일부에서 대부분 시간 소비한다.
      - 성능 퇴적화전까지 보기 쉽게 만들자.
      - 성능 튜닝에 시간 투입 가능(좋은 설계, 기능 추가하기 쉬움, 성능 세밀하게 분석 가능, 프로파일러가 직적해 주는 코드 범위 좁혀짐, 분석이 쉬움, 개선안이 떠오르기 쉬움)
## 2.9 유래
  - 실력 있는 프로그래머는 코드 정리에 시간 할애 한다.
  - 복잡하고 지저분한 코드보다는 깔끔한 코드가 수정하기 쉽게,
  - 처음부터 깔끔하게짜기어렵다
  - 스몰토크(1980년대) 컴파일 링크 실행 주기 

## 2.10 리팩터링 자동화
  - IDE 잘 활용하면 알아서 바꿔주니 제일 정확하다
  - C# 비쥬얼스튜디오용 플러그인들이 있었고, 나중에 항상 장창 되어아ㅣㅆ따
  - 어설픈 방법: 직접 조작시 허점 생기니 항상 테스트 해보자, 첫발 내딛는데 유용
  - 이맥스 도구를 활용해서 직접 해당 메크로를 만들어 활용하자
  - 정적 타입 언어가 변경하기 쉽다(해당 클래스의의 메소드를 찾아가기 쉽기때문에)
  - 갓텔리제이를 쓰자(함수 추출에 추가 기능까지 넣어서 가능)
  - 그래도 한번은 테스트 해보자

## 2.11 더 알고 싶다면
  1) 윌리엄 웨이크: 리팩터링 워크북(충분히 연습 및 예제 제공)
  2) 조슈아 케레에프스키: 패턴을 확용한 리팩터링(디자인 패턴을 활용해 리팩터링 방법 다룸)
  3) 스캇 엠블러,프라모드 사달게: 리팩토링 데이터베이스(데이터베이스)
  4) 엘리엇 러스티 해롤드: 리팩토링 HTML(html)
  5) 마이클 페더스: 레거스 코드 활용 전략(직접적인 리팩터링 언급 x)
  6) 제이필즈,셰인 하비: 리펙터링 루비 에디션(루비 언어에 극한됨) 
