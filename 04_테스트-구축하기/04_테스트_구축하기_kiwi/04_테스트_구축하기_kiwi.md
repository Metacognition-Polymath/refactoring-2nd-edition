리팩터링을 제대로 하려면 불가피하게 저지르는 실수를 잡아주는 견고한 테스트 스위트 (test suite)가 뒷받침돼야 한다.
좋은 테스트 작성하는 일을 개발 효율은 높인다.

## 4.1 자가 테스트 코드의 가치

프로그래머가 일할 때 코드를 작성하는 시간은 비중이 높지 않다.
상황 파악, 설계, 디버깅, 버그 해결하는데 훨씬 많은 비중의 시간을 할애합니다.

모든 테스트를 완전히 자동화하고 그 결과까지 스스로 검사하게 만들자 -> 테스트 성공시 OK 출력하는 방식
- 테스트가 컴파일만큼이나 쉬워지는 마법이 일어난다!
- 테스트 스위트는 강력한 버그 검출 도구로, 버그를 찾는 데 걸리는 시간을 대폭 줄여준다. -> 버그를 찾을 범위를 대폭 줄일 수 있음

테스트 코드를 작성하기 가장 좋은 시점은 프로그래밍을 시작하기 전이다.
1. 기능을 추가하기 위해 무엇이 필요한지 고민하게 된다.
2. 구현보다 인터페이스에 집중하게 된다.
3. 코딩 완료 시점을 정확하게 판단할 수 있다.

켄트 백의 테스트 주도 개발(TDD)
1. 통과하지 못할 테스트를 작성한다.
2. 테스트를 통과하게끔 코드를 작성한다.
3. 결과 코드를 최대한 깔끔하게 리팩터링하는 과정을 짧은 주기로 반복한다.

굉장히 생산적이고 차분하게 코드를 작성할 수 있다.



## 4.3 첫번째 테스트

- 테스트 순서
1. 테스트에 필요한 데이터와 객체 - 픽스쳐 Fixture(고정장치)
2. 픽스처의 속성을 검증

**실패해야 할 상황에서는 반드시 실패하게 만들자.**
```
    get shortfall() {
        return this._demand - this.totalProduction * 2;
    }
```


## 4.4 테스트 추가하기

**완벽하게 만드느라 테스트를 수행하지 못하는 것보다, 불완전한 테스트를 진행하는 것이 낫다.**

테스트끼리 상호작용하게 하는 공유 픽스처'를 지양하자

지저분한 case
```
describe("province test", function () {
  const asia = new Province(sampleProvinceData()); //픽스처 설정
  it("Asia - shortfall", function () {
    assert.equal(asia.shortfall,5);
  });
  it("Asia - profit", function () {
    assert.equal(asia.shortfall,200);
  });
});
```


Good case
```
describe("province", function () {
  let asia;
  beforeEach(() => {
    asia = new Province(sampleProvinceData());
  });

  it("Asia - shortfall", function () {
    assert.equal(asia.shortfall,5);
  });
  it("Asia - profit", function () {
    assert.equal(asia.shortfall,200);
  });
});
```


## 4.5 픽스처 수정하기


- 실전에서는 사용자가 값을 변경하면서 픽스처의 내용도 수정되는 경우가 흔하다.
- 이런 수정 부분은 세터에서 이루어지며, 보통 세터를 잘 테스트하지 않는다.
- 테스트의 흔판 패턴 : 준비 수행 단언, 설정 실행 검증, 조건-발생-결과 세가지 용어로 부른다
- 만약 아주 밀접하다면(감당되면) it 구문 하나에 두가지 이상의 속성 검증 O, 하지만 하나씩 하는게 좋다.


```
  it('change productions', function () {

    asia.producers[0].production = 20;
    assert.equal(asia.shortfall,-6);
    assert.equal(asia.profit,292);
  });
```



## 4.6 경계 조건 검사하기

앞에서 살펴본 테스트는 모두 '꽃길'상황에 집중했다.
그런데 이러한 범위를 벗어나는 경계 지점에서 문제가 생기면 어떤일이 벌어지는지 확인하는 테스트도 함께 작성하면 좋다.

- 문제 생길 가능성이 있는 경계조건을 생각해보고 그 부분을 집중적으로 테스트하자.
- 의식적으로 프로그램을 망가뜨리는 방법을 모색하자.
- 경계 조건에 대응하는 동작이 리팩터링 때문에 변하는지는 신경 쓸 필요없다.

**어차피 모든 버그를 잡아낼 수 없다고 생각하여 테스트를 작성하지 않는다면 대다수의 버그를 잡을 수 있는 기회를 날리는 셈이다.**

## 4.7 끝나지 않은 여정
- 테스트는 반복적으로 진행되어야 한다.
1. 기존 테스트가 충분히 명확한지
2. 테스트 과정을 더 이해하기 쉽게 리팩터링할 순 없는지
3. 제대로 검사하는지
위의 기준을 가지고 테스트를 고도화한다!

**버그 리포트를 받으면 가장 먼저 그 버그를 드러내는 단위 테스트부터 작성하자.**

